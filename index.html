<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Rail2ski</title>
		<meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
		<script src="assets/js/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" href="assets/css/leaflet/1.3.4/leaflet.css"/>
		<link rel="stylesheet" href="assets/css/leaflet.markercluster/1.4.1/MarkerCluster.css"/>
		<link rel="stylesheet" href="assets/css/leaflet.markercluster/1.4.1/MarkerCluster.Default.css"/>
		<script src="assets/js/leaflet/1.3.4/leaflet.js"></script>
		<script src="assets/js/leaflet.ajax/2.1.0/leaflet.ajax.js"></script>
		<script src="assets/js/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
		<style>
		body {
			padding: 0;
			margin: 0;
        	}
		html, body { width: 100%; height : 100%; }
		#map {height:100%;
	            width: 100%;
        	}
		</style>
</head>
<body>
	<div id="map"></div>
	<script>
		var map = L.map('map').setView([47.4, 11.8], 7);

		var background = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery ï¿½ <a href="https://www.mapbox.com/">Mapbox</a>',
			id: 'mapbox.light'
		}).addTo(map);

		/*Deutschland*/

		var v_strecke_de = L.layerGroup().addTo(map);

		$.ajax({
			url: "./Streckennetz/DE/Streckennetz_DE.geojson"
		}).then(function(streckennetz_de_json) {
			var lines = typeof streckennetz_de_json == 'string' ? JSON.parse(streckennetz_de_json) : streckennetz_de_json;
			v_strecke_de.addLayer(
				L.geoJson(lines, {
					style: function (feature) {
						return {color: 'black', weight:2, opacity: 1};
    					}
				}));
			v_strecke_de.addLayer(
				L.geoJson(lines, {
					style: function (feature) {
						return {color: 'white', weight:1, opacity: 1, dashArray : '3, 3'};
		    			}
				}));
		});
		
		
		var v_ski_de = L.markerClusterGroup();
		map.addLayer(v_ski_de);
		$.getJSON("./Skigebiete/DE/Skigebiete_DE.geojson", function(skigebiete_de_json) {
			var features = (typeof skigebiete_de_json == 'string' ? JSON.parse(skigebiete_de_json) : skigebiete_de_json).features;
			for (var index = 0; index < features.length; index++)
			{
				var feature = features[index];
				if (feature.geometry)
				{
					var popupText = "<a href=\"" + feature.properties.url + "\" target=\"skigebiet\">" + feature.properties.name + "</a>";
					var marker = L.marker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], {title: feature.properties.name})
						.bindPopup(popupText)
						.bindTooltip(feature.properties.name, {permanent: true, opacity: 0.8}).openTooltip();
					v_ski_de.addLayer(marker);
				}
			}
		});


		/*Schweiz*/

		var v_strecke_ch = L.geoJson
			.ajax("./Streckennetz/CH/Streckennetz_CH.geojson", {
				style: {
					"color": "#01A9DB",
					"weight": 5
				}
			}).addTo(map);

		var v_ski_ch = L.geoJson
			.ajax("./Skigebiete/CH/Skigebiete_CH.geojson", {
				style:
				{
					radius: 8,
					fillColor: "#ff7800",
					color: "#000000",
					weight: 1,
					opacity: 1,
					fillOpacity: 0.8
				},
				pointToLayer: function (feature, latlng) {
					return L.circleMarker(latlng);
				}
			}).addTo(map);


			/*Österreich*/
			var v_strecke_at = L.geoJson
				.ajax("./Streckennetz/AT/Streckennetz_AT.geojson", {
					style: {
						"color": "#01A9DB",
						"weight": 5
					}
				}).addTo(map);

			var v_ski_at = L.geoJson
					.ajax("./Skigebiete/AT/Skigebiete_AT.geojson", {
						style:
						{
							radius: 8,
							fillColor: "#ff7800",
							color: "#000000",
							weight: 1,
							opacity: 1,
							fillOpacity: 0.8
						},
						pointToLayer: function (feature, latlng) {
							return L.circleMarker(latlng);
						}
					}).addTo(map);


		var baseLayers = {
			"OpenStreetMap": background
		};

		var overlays = {
			"Streckennetz DE": v_strecke_de,
			"Streckennetz CH" : v_strecke_ch,
			"Streckennetz AT" : v_strecke_at,

			"Skigebiet DE": v_ski_de,
			"Skigebiet CH": v_ski_ch,
			"Skigebiet AT" : v_ski_at
		};

		L.control.layers(baseLayers, overlays).addTo(map);
	</script>
</body>
</html>
